local assert = require("luassert")
local ins = require("inspect")
local say = require("say")
local callable = require("luassert.util").callable

local remove_all_metatables = function(item, path)
  if path[#path] ~= ins.METATABLE then
    return item
  end
end

_G._TEST = true
_G.unpack = table.unpack or unpack
_G.inspect = function(v)
  return ins(v, { process = remove_all_metatables })
end
_G.args_repr = function(v)
  -- Convert a table value to inspect output without the outer `{ ... }`.
  return inspect(v):gsub("^%s*{%s*", ""):gsub("%s*}%s*$", "")
end

local positive_msg = "assertion.callable.positive"
local negative_msg = "assertion.callable.negative"
say:set(positive_msg, "Expected object to be callable.\nPassed in:\n%s\nExpected:\ncallable object")
say:set(negative_msg, "Expected object to not be callable.\nPassed in:\n%s\nDid not expect:\ncallable object")

assert:register("assertion", "callable", function(_, args)
  return callable(args[1])
end, positive_msg, negative_msg)

return {}
